## OpenCode Architecture Overview

OpenCode is a client-server architecture AI coding agent with multiple components:

### 1. Core Server (TypeScript/Bun)

Located in packages/opencode/, this is the brain of the system:

• Entry point: src/index.ts - CLI commands router
• Server: HTTP API server (src/server/server.ts) using Hono framework
• Session management: Handles AI conversations and state
• Provider abstraction: Supports multiple AI providers (Anthropic, OpenAI, etc.)
• MCP support: Model Context Protocol for tool integration
• File operations: Ripgrep integration, file watching, LSP support
• Authentication: OpenAuth integration for user management

### 2. TUI Client (Go)

Located in packages/tui/, this is the terminal interface:

• Bubbletea framework: Modern TUI library for interactive terminal apps
• SDK integration: Uses generated Go SDK to communicate with server
• Rich UI components: Chat interface, file browser, syntax highlighting
• Clipboard support: Cross-platform clipboard integration
• Real-time updates: SSE (Server-Sent Events) for streaming responses

### 3. SDKs

Auto-generated clients for different platforms:

• TypeScript SDK (packages/sdk/): Generated by Stainless from OpenAPI spec
• Go SDK (packages/tui/sdk/): Used by the TUI client
• GitHub Action (sdks/github/): GitHub integration
• VS Code Extension (sdks/vscode/): Editor integration

### 4. Web Documentation (packages/web/)

• Astro-based documentation site
• Deployed to Cloudflare Pages
• Marketing and docs at opencode.ai

### 5. Infrastructure (infra/, sst.config.ts)

• SST v3 for infrastructure as code
• Cloudflare deployment
• API endpoints and serverless functions

### How It Works Together:

1. User runs opencode → Launches TUI client (Go)
2. TUI starts local server → TypeScript server on random port
3. Client-Server Communication → Via HTTP API + SSE for streaming
4. AI Integration → Server handles provider abstraction, tool execution
5. File Operations → Server has filesystem access, executes commands
6. Real-time Updates → SSE streams UI updates, AI responses

### Key Design Decisions:

• Provider agnostic: Not locked to any AI provider
• Client-server split: Enables remote operation, multiple frontends
• Generated SDKs: Consistent API across languages via Stainless
• Bun runtime: Fast TypeScript execution for server
• Go for TUI: Better terminal handling than Node.js
• MCP protocol: Extensible tool system

This architecture allows opencode to be extended with different clients (mobile, web) while keeping the core logic centralized in the
TypeScript server.
